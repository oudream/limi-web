<!DOCTYPE html>
<html>
<head lang="en">

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
</head>

<style>


#container {
width:1280px;
margin:0px auto;
}
/*顶部面板样式*/
#header {
width:100%;
height:30px;
border:1px#ADD8E6 solid;
}
/*中间部分面板样式*/
#main {
width:100%;
height:600px;
border:1px#ADD8E6 solid;
}
/*底部面板样式*/
#footer {
width:100%;
height:100px;
border:1px #ADD8E6 solid;
}

.cat {
    float:left;
    width:100px;
    height:100%;
    solid:#CCC;
    text-align:right;
}

.sidebar {
    float:left;
    width:150px;
    height:100%;
}
.content {
    float:left;
    width:900px;
    height:100%;
    border:1px #ADD8E6 solid;
}

.axis path,
.axis line{
    fill: none;
    stroke: black;
    shape-rendering: crispEdges;
}

.axis text {
    font-family: sans-serif;
    font-size: 11px;
}

.rectBackground {
    fill: steelblue;
}

.rectBackground2 {
    fill:#28ff28 ;
}

.textBackground {
    fill: white;
    text-anchor: middle;
}

table.altrowstable {
    font-family: verdana,arial,sans-serif;
    font-size:11px;
    color:#333333;
    border-width: 1px;
    border-color: #a9c6c9;
    border-collapse: collapse;
}
table.altrowstable th {
    border-width: 1px;
    padding: 8px;
    border-style: solid;
    border-color: #a9c6c9;
}
table.altrowstable td {
    border-width: 1px;
    padding: 8px;
    border-style: solid;
    border-color: #a9c6c9;
}
.oddrowcolor{
    background-color:#d4e3e5;
}
.evenrowcolor{
    background-color:#c3dde0;
}



svg, g {
    pointer-events: all;
}
.axis path,
.axis line {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
}

.title {
    text-anchor: middle;
    font-weight: 700;
}


/*.x.axis path {
  display: none;
}*/

.line {
    fill: none;
    stroke: steelblue;
    stroke-width: 1.5px;
}

.linecircle {
    fill: green;
}
.linecircle:hover {
    fill: steelblue;
}
.flag {
    stroke: gray;
    stroke-dasharray: 5;
    stroke-width: 1.5;
    display: none;
    pointer-events: none;
}
.tips {
    pointer-events: none;
    display: none;
}
.tips-border {
    fill: #F3E4E4;
    stroke: gray;
    stroke-width: 2;
}
.grid .tick {
    stroke: lightgrey;
    opacity: 0.7;
}
.grid path {
    stroke-width: 0;
}
</style>

<body>

<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="../js/EfileManage.js" charset="utf-8"></script>
<script src="../js/IcsTableManage.js" charset="utf-8"></script>
<script src="http://localhost:8080/target/target-script-min.js#anonymous"></script>


<script>

    var t = setTimeout("fn_timeOut()", 1000);
    var count = 0;
    var add = true;

    function fn_timeOut() {

        var str = "<! Code=utf-8 Data=1.0 System=data.ygct.sample.ticket Version=1.0 !>\n"
                +"<BarChart_Info::BarChart_Info>\n"
                +"@ F_Session	F_X_Desc F_Y_Desc	 F_Right Top_Text F_Bar_Count\n"
                +"# 2015011202003	 X单位 重量(吨) 单位(吨) 2\n"
                +"</BarChart_Info::BarChart_Info>\n"
                +"<Bar_Info::Bar_Info>\n"
                +"@	F_Bar_Name\n"
                +"#	毛重\n"
                +"#	净重\n"
                +"</Bar_Info::Bar_Info>\n"
                +"<T_BarChart_Data::T_BarChart_Data>\n"
                +"@	F_Name F_Data1 F_Data2\n"
                +"#	矿点1 8694 3567\n"
                +"#	矿点2 5649 2089\n"
                +"#	矿点3 13588 3598\n"
                +"#	矿点4 9427 2958\n"
                +"#	矿点5 12868 8888\n"
                +"#	矿点6 5679 3597\n"
                +"#	矿点7 19487 10369\n"
                +"#	矿点8 7497 1589\n"
                +"</T_BarChart_Data::T_BarChart_Data>";

        var efileArray = ics_EfileManage.parseEFile(str);



        if(efileArray.length>01||efileArray != null)
        {
         //   draw(efileArray);
            alert("11ee111dd1");
            icsTable.draw("testSvg",efileArray);
            icsTable.drawTable("alternatecolor",efileArray);
            icsTable.drawGraph("path_Graph",null,efileArray);

//
//            var d = "M100 20 L300 20 L250 200 L150 200 Z";
//            for(var i=0;i<20;i++)
//            {
//                var svg = d3.selectAll("[id=path_svg]");
//                svg.append("path")
//                        .attr("class","axis")
//                        .attr("id",i)
//                        .attr("stroke","steelblue")
//                        .attr("stroke-width","2")
//                        .attr("fill","none")
//                        .attr("d",d)
//                        .attr("height",300)
//                        .attr("width",300);
//
//            }
            fn_timeOut_drawRontainer();
        }

        //	t = setTimeout("fn_timeOut()", 1000);
    }



    function fn_timeOut_drawRontainer()
    {
        if(count>80)
        {
            add = false;
        }
        if(count<10)
        {
            add = true;
        }
        if(add)
        {
            count++;
        }
        else
        {
            count--;
        }



        icsTable.drawRontainer("path_svg","path_id",count);
        for(var i=1;i<21;i++)
        {
            var randomcount = Math.random()*100;
            icsTable.drawRontainer("path_svg"+i,"path_id"+i,randomcount);
        }

        var t = setTimeout("fn_timeOut_drawRontainer()", 50);
    }


    function draw(efileArray)
    {
        if(efileArray.length<1)
        {
            return;
        }

        var dataArray1 = new Array();
        var dataArray2 = new Array();

        for (var i = 1; i < efileArray[2].length; i++) {
            dataArray1[i-1] = Number(efileArray[2][i][1]);
            dataArray2[i-1] = Number(efileArray[2][i][2]);
        }


        //画布大小
        var width = 900;
        var height = 600;

        //画布周边的空白
        var padding = {left:50, right:50, top:10, bottom:20};
        //在 body 里添加一个 SVG 画布
        var svg = d3.select("#main")
                .append("svg")
                .attr("width", width)
                .attr("height", height);

        var svg = d3.selectAll("[id=testSvg]");
        var testId1 = d3.selectAll("[id=testId1]");
        var testId2 = d3.selectAll("[id=testId2]");

        var lable = testId1.append("lable");
        var lable2 = testId2.append("lable");

        var hh = svg.attr("height");

        var test = efileArray[0][1][2];
        lable.text(efileArray[0][1][2]);
        lable2.text(efileArray[0][1][3]);

        var drawR = testId2.append("svg")
                .attr("width", "100%")
                .attr("height", "100%");


        var testMao = new Array();
        for(var i=0;i<efileArray[1].length;i++)
        {
            testMao[i] = efileArray[1][1][i+1];
        }

        drawR.append("rect") .attr("width", 40)
                .attr("height", 20)
                .attr("x", 0)
                .attr("class", "rectBackground")
                .attr("y", 20);

        drawR.append("rect") .attr("width", 40)
                .attr("height", 20)
                .attr("x", 0)
                .attr("class", "rectBackground2")
                .attr("y", 40+5);



        drawR.append("text")
                .attr("x", 50)
                .attr("y", 35)
                .attr("id", "test-id1");
        d3.selectAll("[id=test-id1]").text(efileArray[1][1][0]);

        drawR.append("text")
                .attr("x", 50)
                .attr("y", 60)
                .attr("id", "test-id2");
        d3.selectAll("[id=test-id2]").text(efileArray[1][2][0]);

        var xScale = d3.scale.ordinal()
                .domain(d3.range(dataArray1.length))
                .rangeRoundBands([0, width - padding.left - padding.right]);


        var max1 = d3.max(dataArray1);
        var max2 = d3.max(dataArray2);
        var maxY
        (max1 > max2) ? maxY = max1: maxY = max2;
        //y轴的比例尺

        var YMaxScal = d3.scale.linear()
                .domain([0,max1])
                .range([0,height - padding.top - padding.bottom]);

        var mm = YMaxScal(max1);
        var yScale = d3.scale.linear()
                .domain([0,max1])
                .range([height - padding.top - padding.bottom, 0]);



        var a = xScale(2);
        var v = xScale(1);
        var vs = xScale(0);
        //定义x轴
        var xAxis = d3.svg.axis()
                .scale(xScale)
                .orient("bottom");

        //定义y轴
        var yAxis = d3.svg.axis()
                .scale(yScale)
                .orient("left");

        //矩形之间的空白
        var rectPadding = 8;

        //添加矩形元素
        var rects = svg.selectAll(".rectBackground")
                .data(dataArray1)
                .enter()
                .append("rect")
                .attr("class","rectBackground")
                .attr("transform","translate(" + padding.left + "," + padding.top + ")")
                .attr("x", function(d,i){
                    return xScale(i) + rectPadding/2;
                })
                .attr("y",function(d){
                    return yScale(d);
                })
                .attr("width", (xScale.rangeBand() - rectPadding)/2 )
                .attr("height", function(d){
                    return height - padding.top - padding.bottom - yScale(d);
                });

        //添加矩形元素
        var rects = svg.selectAll(".rectBackground2")
                .data(dataArray2)
                .enter()
                .append("rect")
                .attr("class","rectBackground2")
                .attr("transform","translate(" + padding.left + "," + padding.top + ")")
                .attr("x", function(d,i){
                    return xScale(i) + rectPadding/2+(xScale.rangeBand() - rectPadding)/2+1;
                })
                .attr("y",function(d){
                    return yScale(d);
                })
                .attr("width", (xScale.rangeBand() - rectPadding)/2 )
                .attr("fill", "red")
                .attr("height", function(d){
                    return height - padding.top - padding.bottom - yScale(d);
                });


        //添加文字元素
        var texts = svg.selectAll(".MyText")
                .data(dataArray2)
                .enter()
                .append("text")
                .attr("class","textBackground")
                .attr("transform","translate(" + padding.left + "," + padding.top + ")")
                .attr("x", function(d,i){
                    return xScale(i) + rectPadding/2;
                } )
                .attr("y",function(d){
                    return yScale(d);
                })
                .attr("dx",function(){
                    return (xScale.rangeBand() - rectPadding)/4+(xScale.rangeBand() - rectPadding)/2+1;
                })
                .attr("dy",function(d){
                    return 20;
                })
                .text(function(d){
                    return d;
                });

        document.getElementById("footer").style.display="none";

        //添加文字元素
        var texts = svg.selectAll(".MyText")
                .data(dataArray1)
                .enter()
                .append("text")
                .attr("class","textBackground")
                .attr("transform","translate(" + padding.left + "," + padding.top + ")")
                .attr("x", function(d,i){
                    return xScale(i) + rectPadding/2;
                } )
                .attr("y",function(d){
                    return yScale(d);
                })
                .attr("dx",function(){
                    return (xScale.rangeBand() - rectPadding)/4;
                })
                .attr("dy",function(d){
                    return 20;
                })
                .text(function(d){
                    return d;
                });

        //添加x轴
        svg.append("g")
                .attr("class","axis")
                .attr("transform","translate(" + padding.left + "," + (height - padding.bottom) + ")")
                .call(xAxis);

        //添加y轴
        svg.append("g")
                .attr("class","axis")
                .attr("transform","translate(" + padding.left + "," + padding.top + ")")
                .call(yAxis);
    }

</script>

<!--
<div id="container">
    <div id="header">

    </div>
    <div id="main" >
        <div class="cat" id="testId1"></div>
        <div class="content">
        <svg id="testSvg" weigth="800" height="500">

        </svg>
        </div>

        <div class="sidebar" id="testId2"></div>

    </div>

    <div id="footer" >kkkkkk</div>



</div>
-->

<svg id="testSvg" width="1200" height="500" x="0" y="0">

</svg>
</body>


<!-- Table goes in the document BODY -->
<table class="altrowstable" id="alternatecolor">
    <!--<tr>-->
        <!--<th>Info Header 1</th><th>Info Header 2</th><th>Info Header 3</th>-->
    <!--</tr>-->
    <!--<tr>-->
        <!--<td>Text 1A</td><td>Text 1B</td><td>Text 1C</td>-->
    <!--</tr>-->
    <!--<tr>-->
        <!--<td>Text 2A</td><td>Text 2B</td><td>Text 2C</td>-->
    <!--</tr>-->
    <!--</tr>-->
    <!--<tr>-->
        <!--<td>Text 3A</td><td>Text 3B</td><td>Text 3C</td>-->
    <!--</tr>-->
    <!--<tr>-->
        <!--<td>Text 4A</td><td>Text 4B</td><td>Text 4C</td>-->
    <!--</tr>-->
    <!--<tr>-->
        <!--<td>Text 5A</td><td>Text 5B</td><td>Text 5C</td>-->
    <!--</tr>-->
</table>

<svg id="path_svg" height="300" width="300">
    <path id="path_id" d="M100 20 L300 20 L250 200 L150 200 Z" fill="none" stroke="steelblue" stroke-width="2"/>
</svg>

<svg id="path_svg1" height="300" width="300">
    <path id="path_id1" d="M100 20 L300 20 L250 200 L150 200 Z" fill="none" stroke="steelblue" stroke-width="2"/>
</svg>
<svg id="path_svg2" height="300" width="300">
    <path id="path_id2" d="M100 20 L300 20 L250 200 L150 200 Z" fill="none" stroke="steelblue" stroke-width="2"/>
</svg>
<svg id="path_svg3" height="300" width="300">
    <path id="path_id3" d="M100 20 L300 20 L250 200 L150 200 Z" fill="none" stroke="steelblue" stroke-width="2"/>
</svg>
<svg id="path_svg4" height="300" width="300">
    <path id="path_id4" d="M100 20 L300 20 L250 200 L150 200 Z" fill="none" stroke="steelblue" stroke-width="2"/>
</svg>
<svg id="path_svg5" height="300" width="300">
    <path id="path_id5" d="M100 20 L300 20 L250 200 L150 200 Z" fill="none" stroke="steelblue" stroke-width="2"/>
</svg>
<svg id="path_svg6" height="300" width="300">
    <path id="path_id6" d="M100 20 L300 20 L250 200 L150 200 Z" fill="none" stroke="steelblue" stroke-width="2"/>
</svg>
<svg id="path_svg7" height="300" width="300">
    <path id="path_id7" d="M100 20 L300 20 L250 200 L150 200 Z" fill="none" stroke="steelblue" stroke-width="2"/>
</svg>
<svg id="path_svg8" height="300" width="300">
    <path id="path_id8" d="M100 20 L300 20 L250 200 L150 200 Z" fill="none" stroke="steelblue" stroke-width="2"/>
</svg>
<svg id="path_svg9" height="300" width="300">
    <path id="path_id9" d="M100 20 L300 20 L250 200 L150 200 Z" fill="none" stroke="steelblue" stroke-width="2"/>
</svg>
<svg id="path_svg10" height="300" width="300">
    <path id="path_id10" d="M100 20 L300 20 L250 200 L150 200 Z" fill="none" stroke="steelblue" stroke-width="2"/>
</svg>
<svg id="path_svg11" height="300" width="300">
    <path id="path_id11" d="M100 20 L300 20 L250 200 L150 200 Z" fill="none" stroke="steelblue" stroke-width="2"/>
</svg>
<svg id="path_svg12" height="300" width="300">
    <path id="path_id12" d="M100 20 L300 20 L250 200 L150 200 Z" fill="none" stroke="steelblue" stroke-width="2"/>
</svg>
<svg id="path_svg13" height="300" width="300">
    <path id="path_id13" d="M100 20 L300 20 L250 200 L150 200 Z" fill="none" stroke="steelblue" stroke-width="2"/>
</svg>
<svg id="path_svg14" height="300" width="300">
    <path id="path_id14" d="M100 20 L300 20 L250 200 L150 200 Z" fill="none" stroke="steelblue" stroke-width="2"/>
</svg>
<svg id="path_svg15" height="300" width="300">
    <path id="path_id15" d="M100 20 L300 20 L250 200 L150 200 Z" fill="none" stroke="steelblue" stroke-width="2"/>
</svg>


<svg id="path_svg16" height="300" width="300">
    <path id="path_id16" d="M100 20 L300 20 L250 200 L150 200 Z" fill="none" stroke="steelblue" stroke-width="2"/>
</svg>
<svg id="path_svg17" height="300" width="300">
    <path id="path_id17" d="M100 20 L300 20 L250 200 L150 200 Z" fill="none" stroke="steelblue" stroke-width="2"/>
</svg>
<svg id="path_svg18" height="300" width="300">
    <path id="path_id18" d="M100 20 L300 20 L250 200 L150 200 Z" fill="none" stroke="steelblue" stroke-width="2"/>
</svg>
<svg id="path_svg19" height="300" width="300">
    <path id="path_id19" d="M100 20 L300 20 L250 200 L150 200 Z" fill="none" stroke="steelblue" stroke-width="2"/>
</svg>
<svg id="path_svg20" height="300" width="300">
    <path id="path_id20" d="M100 20 L300 20 L250 200 L150 200 Z" fill="none" stroke="steelblue" stroke-width="2"/>
</svg>






<svg id="path_Graph" height="600" width="800">





</svg>
</html>